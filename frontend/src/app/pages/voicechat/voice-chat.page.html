<p-dialog
  [(visible)]="visible"
  [modal]="true"
  [style]="{ width: '400px', height: '600px' }"
  [draggable]="false"
  [resizable]="false"
  header="AI Kitchen Assistant"
  (onHide)="closeChat()"
  styleClass="voice-chat-dialog"
>
  <div class="chat-container flex flex-column gap-3 p-3 overflow-y-auto" #chatContainer>
    <div class="message ai align-self-start">
      <div class="avatar">
        <img src="/assets/logo/logoProject.svg" alt="AI" />
      </div>
      <div class="bubble bg-gray-100 text-900">
        ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡∏ü‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ï‡∏π‡πâ‡πÄ‡∏¢‡πá‡∏ô‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö? üë®‚Äçüç≥
      </div>
    </div>

    <div
      *ngFor="let msg of messages"
      class="message flex gap-2"
      [ngClass]="{
        'align-self-end user': msg.sender === 'user',
        'align-self-start ai': msg.sender === 'ai'
      }"
    >
      <div class="avatar" *ngIf="msg.sender === 'ai'">
        <img src="/assets/logo/logoProject.svg" alt="AI" />
      </div>

      <div
        class="bubble p-3 border-round-xl shadow-1"
        [ngClass]="{
          'bg-blue-500 text-white': msg.sender === 'user',
          'bg-gray-100 text-900': msg.sender === 'ai'
        }"
      >
        {{ msg.text }}
        <div class="text-xs mt-1 opacity-70 text-right">{{ msg.time | date : 'shortTime' }}</div>
      </div>
    </div>

    <div *ngIf="isProcessing" class="message ai align-self-start">
      <div class="bubble bg-gray-50 text-500 font-italic">
        <i class="pi pi-spin pi-spinner mr-2"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏¥‡∏î...
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex flex-column align-items-center justify-content-center pt-2 gap-3">
      <div
        class="status-text text-sm font-semibold h-2rem fadein animation-duration-300"
        [ngClass]="{ 'text-red-500': isListening, 'text-gray-500': !isListening }"
      >
        {{ statusText }}
      </div>

      <button
        pButton
        pRipple
        type="button"
        [icon]="isListening ? 'pi pi-stop' : 'pi pi-microphone'"
        class="p-button-rounded p-button-lg w-4rem h-4rem shadow-4 transition-all transition-duration-200"
        [ngClass]="{ 'p-button-danger scale-110': isListening, 'p-button-primary': !isListening }"
        (click)="toggleSpeech()"
      ></button>

      <small class="text-500">‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢</small>
    </div>
  </ng-template>
</p-dialog>
